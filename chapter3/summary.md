## ls命令
+ __经常用到的命令行选项__

| 命令 | 说明 |
| ---- | ---- |
| ls - a | 列出的内容包含以``.``开头的文件|
| ls -lu | 显示最后访问时间|
| ls -s | 显示以块为单位的文件大小 |
| ls -t | 输出时按时间排序 |
| ls -F | 显示文件类型 |

+ __目录__  
目录是一种特殊的文件，它的内容是文件和目录的名字。目录包含很多记录，每个记录的格式由统一的标准定义。每条记录的内容代表一个文件或记录。  
目录文件永远不会为空，每个目录都至少包含两个特殊的项 —— “.” 和 “..”， 前者表示当前目录，后者表示上一级目录。  
从目录读数据与从文件读数据是类似的，opendir打开一个目录，返回一个DIR类型的指针。readdir返回目录中的当前项，返回一个指向目录的当前记录的指针，记录的类型是``struct dirent``, 这个结构定义在``/usr/include/dirent.h``中。closedir关闭一个目录，seekdir,telldir,rewinddir与lseek的功能类似。
+ __stat__  
提取文件状态的系统调用是stat。  
磁盘上的文件有很多属性，如文件大小，文件所有者的ID等。如果需要得到文件属性，进程可以定义一个结构``struct stat``，然后调用stat,告诉内核把文件属性存放到这个结构中。  
  + 头文件：``#include <sys/stat.h>``
  + 函数原型：``int result = stat(char *fname, struct stat *bufp)``
  + 返回值：``-1``遇到错误;``0``成功返回。
+ __模式字段__  
文件类型和许可权限存储在``st_mode``中，``st_mode``是一个16位的二进制数。其中前四位用作文件类型，最多可以标识16种类型;接下来的三位是文件的特殊属性，1代表具有某个属性，0代表没有，这三位分别是 ``set-user-ID``, ``set-group-ID``, ``sticky``。最后的9位是许可权限，分为3组，分别是文件所有者，同组用户和其他用户，每组三位，分别是读，写和执行的权限。
+ __子域掩码（subfield coding）__  
掩码会将不需要的字段置0,需要的字段的值不发生改变。  
使用掩码可以得到文件类型和许可权限。
+ __用于/组ID__  
系统中的每个用户都有用户名和用户ID，人们可以用用户名登录到系统。系统通过UID来区分不同用户的文件，每个用户都属于至少一个组。  
每个Unix系统都有``/etc/passwd``文件，但它并没有包含所有的用户，而是在一台都能够访问的主机上保存所有用户信息，它被称作NIS。所有的主机通过NIS进行用户身份验证，而本地只保留一个子集以备离线操作。  
可以通过库函数``getpwuid``来访问用户信息。这个函数需要user ID作为参数，返回一个指向``struct psswd``的指针，这个结构定义在``/usr/include/pwd.h``中。  
+ __三个特殊的位__
  + set-user-ID位：当文件的该位有设置时，表示当该文件被执行时，程序具有文件所有者的权限而不是执行者的权限。如passwd命令修改用户密码时，给passwd命令一个特殊的权限。
  + set-group-ID位：和set-user-id同理，不过具有的是所有组的权限。
  + sticky位：早期的Unix系统在有限的内存中使用到交换技术，使得从交换空间装载程序比在普通的硬盘上快，交换空间上的文件时不分块的。  
  sticky位告诉内核即使没有人在实用程序，也要把它放到交换空间上。有了虚拟技术后，交换技术不再重要了。  
  对于目录而言，有些目录如``/tmp``被设计来存放临时文件，sticky位使得存放在这个目录下的文件只能被创建者删除，别人不能够删除。

+ __设置和修改文件的属性__
文件的类型有普通文件，目录文件，设备文件，socket文件，符号链接文件，命名管道文件等。文件类型无法修改。  
每个文件都有9位的许可权限和3位的特殊属性，创建以后，可以通过chmod系统调用修改。
  + 建立文件：  
  creat的第二个参数指定了要创建文件的许可位，如：``fd = creat("newfile", 0744);``第二个参数只是请求，而不是命令。内核会通过"新建文件掩码（file-creation-mask）"来得到文件的最终模式。新建文件掩码是一个系统变量，指定哪些位需要被关掉。
  + 改变文件的模式：程序可以通过调用chmod来改变文件的模式。系统调用chmod不受新建文件掩码的影响。头文件：``#include <sus/types.h>, #include <sys/stat.h>``; 函数原型 ``int result = chmod(char *path, mode_t mode)``;返回值：``-1``遇到错误，``0``成功返回。shell命令chmod也可以用来完成上述操作，八进制模式或者符号模式（如``u=rws g=rw o=r``）。
  + 文件所有者和组：通过系统调用chown来修改文件所有者和组。头文件：``#include <unistd.h>``;函数原型``int chown(char *path, uid_t owner, gid_t group)``。
  + 时间：utime系统调用可以用来设置最后修改时间和最后访问时间，shell命令touch可以修改文件的最后访问时间和最后修改时间。
  + 文件名：系统调用rename可以修改文件/目录的名字。
+ __小结__
  + 磁盘上有文件和目录，文件和目录都有内容和属性。文件的内容可以时任意的数据，目录的内容只能是文件名/子目录名的列表。
  + 目录中的文件名/子目录名指向文件和其他的目录，内核提供了系统调用来读取目录的内容，读取和修改文件的属性。
  + 文件类型，文件的访问权限和特殊属性被编码存储在一个16位的整数中，可以通过掩码技术来读取这些信息。
  + 文件所有者和组信息是以ID的形式保存的，它们与用户名和组名的联系保存在passwd和group数据库中。
